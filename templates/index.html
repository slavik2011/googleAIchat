<!DOCTYPE html>
<html>
<head>
    <title>Chat with AI</title>
    <style>
        /* ... Your CSS ... */
        /*  Add your CSS styles here for the chat interface */
        body {
            font-family: sans-serif;
        }
        .chat-container {
          height: 500px; /* Adjust as needed */
          border: 1px solid #ccc;
          display: flex;
          flex-direction: column;
        }
        .chat-messages {
          flex: 1;
          overflow-y: auto;
          padding: 10px;
        }
        .message {
          margin-bottom: 10px;
          padding: 8px;
          border-radius: 5px;
          max-width: 70%;
        }
        .user-message {
          background-color: #e9ecef;
          align-self: flex-end; /* Align to the right */
        }
        .ai-message {
          background-color: #ADD8E6; /* Light blue */
          align-self: flex-start; /* Align to the left */
        }
        .chat-input {
          padding: 10px;
          border-top: 1px solid #ccc;
        }
        #user-input {
          width: calc(100% - 70px); /* Adjust as needed */
          padding: 8px;
          border: 1px solid #ccc;
          border-radius: 5px;
        }
        #submit-button {
          padding: 8px 15px;
          border: none;
          background-color: #007bff; /* Blue */
          color: white;
          border-radius: 5px;
          cursor: pointer;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>Chat with AI</h1>
            <p>Your UUID: <span id="user-uuid">{{ uuid }}</span></p>
        </div>
        <div class="chat-messages" id="chat-messages">
        </div> 
        <div class="chat-input">
            {% if error_message %}
                <div class="error-message">{{ error_message }}</div>
            {% endif %}
            <form id="chat-form" method="POST">
                <input type="text" id="user-input" name="user-input" placeholder="Type your message..." required>
                <button type="submit" id="submit-button">Send</button>
            </form>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            const userUuid = $("#user-uuid").text();

            $("#chat-form").submit(function (e) {
                e.preventDefault();
                const userMessage = $("#user-input").val();
                displayMessage("user-message", userMessage);
                $("#user-input").val(""); // Clear input field

                $.ajax({
                    url: "/",
                    type: "POST",
                    data: $(this).serialize(),
                    success: function (response) {
                        console.log("Server Response:", response);
                        if (response.error) {
                            displayMessage("ai-message", response.error);
                            return;
                        }
                        displayMessage("ai-message", response.ai_response);
                        sendObservations(userUuid);
                    },
                    error: function (xhr, status, error) {
                        console.error("AJAX Error:", error);
                        displayMessage("ai-message", "Error: " + error);
                    }
                });
            });

            function displayMessage(messageClass, messageText) {
                $("#chat-messages").append(`<div class="message ${messageClass}">${messageText}</div>`);
                $("#chat-messages").scrollTop($("#chat-messages")[0].scrollHeight);
            }

            function sendObservations(uuid) {
                $.ajax({
                    url: `/get_observations/${uuid}`,
                    type: "GET",
                    success: function (response) {
                        console.log("Observations sent:", response);
                    },
                    error: function (xhr, status, error) {
                        console.error("Error sending observations:", error);
                    }
                });
            }
        });
    </script>
</body>
</html>
